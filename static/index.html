<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Point Cloud Viewer</title>
    <link rel="stylesheet" href="/static/css/viewer.css">
</head>
<body>
    <div id="leftPane" class="pane">
        <div class="tab-container">
            <div class="tab-header">
                <div class="tab" data-tab="files">üìÅ Files</div>
                <div class="tab" data-tab="controls">üéÆ Controls</div>
                <div class="tab" data-tab="slice">‚úÇÔ∏è Slice</div>
            </div>
            <div class="tab-content">
                <!-- Files Tab -->
                <div class="tab-panel" data-panel="files">
                    <div class="tool-section">
                        <h3>üìÅ File Upload</h3>
                        <input type="file" id="fileInput" accept=".ply" />
                        <button id="uploadBtn">Upload PLY File</button>
                        <div id="progressContainer" style="display: none; margin-top: 10px;">
                            <div id="progressBar" style="width: 100%; background-color: #333; border-radius: 4px; overflow: hidden;">
                                <div id="progressFill" style="height: 20px; background-color: #4CAF50; width: 0%; transition: width 0.3s ease;"></div>
                            </div>
                            <div id="progressText" style="text-align: center; margin-top: 5px; font-size: 12px; color: #ccc;">Uploading...</div>
                        </div>
                        <div id="status"></div>
                    </div>

                    <!-- Point Cloud List -->
                    <div class="tool-section">
                        <h3>‚òÅÔ∏è Point Clouds</h3>
                        <div id="pointCloudList">
                            <!-- Point cloud items will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Controls Tab -->
                <div class="tab-panel" data-panel="controls">
                    <div class="tool-section">
                        <h3>üìç Camera Position</h3>
                        <div id="positionInfo" style="font-size: 11px; color: #aaa; line-height: 1.6; font-family: monospace;">
                            <div>X: <span id="camX">0.0</span> m</div>
                            <div>Y: <span id="camY">0.0</span> m</div>
                            <div>Z: <span id="camZ">0.0</span> m</div>
                        </div>
                    </div>
                    <div class="tool-section">
                        <h3>üîç Level of Detail</h3>
                        <div id="lodInfo" style="font-size: 11px; color: #aaa; line-height: 1.6; font-family: monospace;">
                            <div>Depth: <span id="lodDepth" style="color: #4CAF50; font-weight: bold;">0</span></div>
                            <div>Nodes: <span id="lodNodes">1</span></div>
                            <div style="font-size: 10px; margin-top: 4px; color: #666;">M: More detail<br>N: Less detail</div>
                        </div>
                    </div>
                    <div class="tool-section">
                        <h3>üéÆ Controls</h3>
                        <div class="controls-info">
                            <strong>Mouse:</strong><br>
                            ‚Ä¢ Left click + drag: Rotate<br>
                            ‚Ä¢ Right click + drag: Pan<br>
                            ‚Ä¢ Mouse wheel: Zoom<br>
                            <br>
                            <strong>Walk Mode:</strong><br>
                            ‚Ä¢ W/S: Forward/Backward<br>
                            ‚Ä¢ A/D: Strafe Left/Right<br>
                            ‚Ä¢ Y or Z: Move UP (vertical)<br>
                            ‚Ä¢ C: Move DOWN (vertical)<br>
                            ‚Ä¢ Q/E: Turn head left/right<br>
                            ‚Ä¢ Shift: Run (4 m/s vs 1.5 m/s)<br>
                            <br>
                            <strong>Level of Detail:</strong><br>
                            ‚Ä¢ M: More detail (load finer LOD)<br>
                            ‚Ä¢ N: Less detail (show coarser LOD)
                        </div>
                    </div>
                </div>

                <!-- Slice Tab -->
                <div class="tab-panel" data-panel="slice">
                    <div class="tool-section">
                        <h3>‚úÇÔ∏è Slice Tool</h3>
                        <div class="slice-controls">
                            <button id="createSliceBtn" class="slice-button">Create Slice</button>
                            <button id="cancelSliceBtn" class="slice-button" style="display: none;">Cancel</button>
                        </div>
                        <div class="slice-info">
                            Click "Create Slice" then draw a line on the 3D viewer. The slice will be perpendicular to your viewing direction.
                        </div>
                        <div class="slice-list" id="sliceList">
                            <!-- Slice items will be added here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="container" class="pane">
        <div class="tab-container">
            <div class="tab-header">
                <div class="tab" data-tab="viewer3d">üéØ 3D Viewer</div>
            </div>
            <div class="tab-content">
                <!-- 3D Viewer Tab -->
                <div class="tab-panel full-height" data-panel="viewer3d">
                    <div id="viewer"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="rightPane" class="pane">
        <div class="tab-container">
            <div class="tab-header">
                <div class="tab" data-tab="hierarchy">üå≥ Hierarchy</div>
                <div class="tab" data-tab="properties">üìã Properties</div>
                <div class="tab" data-tab="sliceview">üìê Slice View</div>
            </div>
            <div class="tab-content">
                <!-- Hierarchy Tab -->
                <div class="tab-panel" data-panel="hierarchy">
                    <div class="tool-section">
                        <h3>üå≥ Object Hierarchy</h3>
                        <div id="hierarchyTree">
                            <!-- Hierarchy will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Properties Tab -->
                <div class="tab-panel" data-panel="properties">
                    <div class="tool-section">
                        <h3>üìã Properties</h3>
                        <div id="objectProperties">
                            <div style="color: #666; font-style: italic; font-size: 12px;">
                                Select an object to view properties
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Slice View Tab -->
                <div class="tab-panel full-height" data-panel="sliceview">
                    <div id="sliceViewHeader">
                        <h3 style="margin: 0;">üìê 2D Slice View</h3>
                        <div id="sliceViewInfo" style="font-size: 12px; color: #aaa; margin-top: 4px;">
                            Select a slice to view 2D projection
                        </div>
                    </div>
                    <div id="sliceViewContainer">
                        <canvas id="sliceCanvas"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- Potree dependencies -->
    <script src="/potree/libs/jquery/jquery-3.1.1.min.js"></script>
    <script src="/potree/libs/proj4/proj4.js"></script>
    <script src="/potree/libs/other/BinaryHeap.js"></script>
    <script src="/potree/libs/tween/tween.min.js"></script>
    <script src="/potree/libs/d3/d3.js"></script>
    <script src="/potree/libs/potree/potree.js"></script>

    <!-- Application scripts -->
    <script src="/static/js/tab-manager.js"></script>
    <script src="/static/js/point-cloud-viewer.js"></script>

    <script>
        // Initialize the viewer when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            // Initialize tab system first
            window.tabManager = new TabManager();

            // Then initialize point cloud viewer
            window.pointCloudViewer = new PointCloudViewer();
        });
    </script>
</body>
</html>
